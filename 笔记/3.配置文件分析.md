# Ant Design é…ç½®æ–‡ä»¶åˆ†æ

## ğŸ“‹ é…ç½®æ–‡ä»¶æ¦‚è§ˆ

### é…ç½®æ–‡ä»¶åˆ†ç±»

- **æ„å»ºé…ç½®**: webpack.config.js, .antd-tools.config.js
- **æ–‡æ¡£é…ç½®**: .dumirc.ts
- **ä»£ç è´¨é‡**: eslint.config.mjs, biome.json
- **æµ‹è¯•é…ç½®**: .jest.js, jest-puppeteer.config.js
- **ç±»å‹é…ç½®**: tsconfig.json, tsconfig-old-react.json
- **CI/CD**: .github/workflows/
- **å…¶ä»–é…ç½®**: package.json, .gitignore, .prettierrc ç­‰

## ğŸ”§ æ„å»ºé…ç½®æ–‡ä»¶

### 1. webpack.config.js - ä¸»è¦æ„å»ºé…ç½®

#### é…ç½®æ¦‚è§ˆ

```javascript
// ä¸»è¦åŠŸèƒ½ï¼šæ„å»º dist æ–‡ä»¶
const getWebpackConfig = require('@ant-design/tools/lib/getWebpackConfig');
const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');
const { codecovWebpackPlugin } = require('@codecov/webpack-plugin');
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **å¤šç¯å¢ƒæ„å»º**: æ”¯æŒå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
2. **å›½é™…åŒ–æ”¯æŒ**: æ·»åŠ å¤šè¯­è¨€åŒ…
3. **å¤–éƒ¨ä¾èµ–**: å¤–éƒ¨åŒ– dayjs å’Œ cssinjs
4. **ä»£ç åˆ†æ**: é›†æˆ BundleAnalyzer
5. **ä»£ç è¦†ç›–ç‡**: é›†æˆ Codecov
6. **å¾ªç¯ä¾èµ–æ£€æµ‹**: é˜²æ­¢å¾ªç¯ä¾èµ–

#### å…³é”®å‡½æ•°

```javascript
// æ·»åŠ å›½é™…åŒ–æ”¯æŒ
function addLocales(config) {
  const newConfig = { ...config };
  let packageName = 'antd-with-locales';
  if (newConfig.entry['antd.min']) {
    packageName += '.min';
  }
  newConfig.entry[packageName] = './index-with-locales.js';
  newConfig.output.filename = '[name].js';
  return newConfig;
}

// å¤–éƒ¨åŒ– dayjs
function externalDayjs(config) {
  const newConfig = { ...config };
  newConfig.externals.dayjs = {
    root: 'dayjs',
    commonjs2: 'dayjs',
    commonjs: 'dayjs',
    amd: 'dayjs',
  };
  return newConfig;
}
```

### 2. .antd-tools.config.js - æ„å»ºå·¥å…·é…ç½®

#### é…ç½®æ¦‚è§ˆ

```javascript
// ä¸»è¦åŠŸèƒ½ï¼šæ„å»ºåçš„æ–‡ä»¶å¤„ç†
const restCssPath = path.join(process.cwd(), 'components', 'style', 'reset.css');
const tokenStatisticPath = path.join(process.cwd(), 'components', 'version', 'token.json');
const tokenMetaPath = path.join(process.cwd(), 'components', 'version', 'token-meta.json');
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **ç¼–è¯‘åå¤„ç†**: å¤åˆ¶å¿…è¦æ–‡ä»¶åˆ°è¾“å‡ºç›®å½•
2. **åˆ†å‘åå¤„ç†**: å¤„ç†æœ€ç»ˆåˆ†å‘æ–‡ä»¶
3. **Token ç»Ÿè®¡**: å¤„ç†è®¾è®¡ token ç›¸å…³æ–‡ä»¶

## ğŸ“š æ–‡æ¡£é…ç½®æ–‡ä»¶

### .dumirc.ts - Dumi æ–‡æ¡£ç”Ÿæˆå™¨é…ç½®

#### é…ç½®æ¦‚è§ˆ

```typescript
export default defineConfig({
  plugins: ['dumi-plugin-color-chunk'],
  routePrefetch: {},
  manifest: {},
  conventionRoutes: {
    exclude: [/index\/components\//],
  },
  ssr: process.env.NODE_ENV === 'production' ? { builder: 'mako' } : false,
  hash: true,
  mfsu: false,
  mako: ['Darwin', 'Linux'].includes(os.type()) ? {} : false,
  crossorigin: {},
  runtimePublicPath: {},
  outputPath: '_site',
});
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **å¤šè¯­è¨€æ”¯æŒ**: ä¸­è‹±æ–‡æ–‡æ¡£
2. **è·¯ç”±é…ç½®**: è‡ªåŠ¨ç”Ÿæˆè·¯ç”±
3. **æ„å»ºä¼˜åŒ–**: SSRã€MFSUã€Mako
4. **è·¯å¾„åˆ«å**: ç»„ä»¶åº“è·¯å¾„æ˜ å°„
5. **æ’ä»¶é›†æˆ**: è‡ªå®šä¹‰æ’ä»¶

#### è·¯å¾„åˆ«åé…ç½®

```typescript
alias: {
  'antd/lib': path.join(__dirname, 'components'),
  'antd/es': path.join(__dirname, 'components'),
  'antd/locale': path.join(__dirname, 'components/locale'),
  antd: path.join(__dirname, 'components'),
  '@ant-design/icons$': '@ant-design/icons/lib',
},
```

## ğŸ› ï¸ ä»£ç è´¨é‡é…ç½®

### 1. eslint.config.mjs - ESLint é…ç½®

#### é…ç½®æ¦‚è§ˆ

```javascript
export default antfu(
  {
    ignores: [
      '**/node_modules/**',
      '**/dist/**',
      '**/_site/**',
      '**/es/**',
      '**/lib/**',
      '**/.dumi/tmp/**',
      '**/.dumi/tmp-production/**',
      '**/*.snap',
      '**/*.md',
      '.dumi/scripts/clarity.js',
    ],
    settings: {
      polyfills: ['Promise', 'URL'],
    },
    type: 'lib',
    stylistic: false,
    typescript: true,
    react: true,
  },
  // å…¶ä»–é…ç½®...
);
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **åŸºç¡€é…ç½®**: ä½¿ç”¨ antfu é¢„è®¾
2. **TypeScript æ”¯æŒ**: å®Œæ•´çš„ TS è§„åˆ™
3. **React æ”¯æŒ**: React å’Œ React Hooks è§„åˆ™
4. **å¯è®¿é—®æ€§**: jsx-a11y è§„åˆ™
5. **å…¼å®¹æ€§**: compat æ’ä»¶
6. **æµ‹è¯•æ”¯æŒ**: Jest è§„åˆ™

### 2. biome.json - Biome ä»£ç æ ¼å¼åŒ–é…ç½®

#### é…ç½®æ¦‚è§ˆ

```json
{
  "$schema": "./node_modules/@biomejs/biome/configuration_schema.json",
  "files": {
    "ignoreUnknown": true,
    "includes": ["**", "!.dumi/tmp*", "!dist/*", "!es/**/*", "!lib/**/*"]
  },
  "formatter": {
    "enabled": true,
    "indentStyle": "space",
    "lineWidth": 100,
    "indentWidth": 2
  },
  "javascript": {
    "jsxRuntime": "reactClassic",
    "formatter": {
      "quoteStyle": "single"
    }
  }
}
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **ä»£ç æ ¼å¼åŒ–**: ç»Ÿä¸€çš„ä»£ç é£æ ¼
2. **Linting**: ä»£ç è´¨é‡æ£€æŸ¥
3. **æ–‡ä»¶è¿‡æ»¤**: æ’é™¤ä¸éœ€è¦å¤„ç†çš„æ–‡ä»¶
4. **è§„åˆ™é…ç½®**: è‡ªå®šä¹‰ linting è§„åˆ™

## ğŸ§ª æµ‹è¯•é…ç½®æ–‡ä»¶

### .jest.js - Jest æµ‹è¯•é…ç½®

#### é…ç½®æ¦‚è§ˆ

```javascript
module.exports = {
  verbose: true,
  testEnvironment: 'jsdom',
  setupFiles: ['./tests/setup.ts', 'jest-canvas-mock'],
  setupFilesAfterEnv: ['./tests/setupAfterEnv.ts'],
  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'md'],
  modulePathIgnorePatterns: ['/_site/'],
  moduleNameMapper: {
    '/\\.(css|less)$/': 'identity-obj-proxy',
    '^antd$': '<rootDir>/components/index',
    '^antd/es/(.*)$': '<rootDir>/components/$1',
    '^antd/lib/(.*)$': '<rootDir>/components/$1',
    '^antd/locale/(.*)$': '<rootDir>/components/locale/$1',
  },
};
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **æµ‹è¯•ç¯å¢ƒ**: jsdom ç¯å¢ƒ
2. **æ¨¡å—æ˜ å°„**: è·¯å¾„åˆ«åæ”¯æŒ
3. **æ–‡ä»¶è½¬æ¢**: TypeScriptã€Markdown ç­‰
4. **è¦†ç›–ç‡æ”¶é›†**: è¯¦ç»†çš„è¦†ç›–ç‡é…ç½®
5. **å¹¶è¡Œæ‰§è¡Œ**: å¤šè¿›ç¨‹æµ‹è¯•

#### æ¨¡å—æ˜ å°„é…ç½®

```javascript
moduleNameMapper: {
  // æ ·å¼æ–‡ä»¶å¤„ç†
  '/\\.(css|less)$/': 'identity-obj-proxy',

  // ç»„ä»¶åº“è·¯å¾„æ˜ å°„
  '^antd$': '<rootDir>/components/index',
  '^antd/es/(.*)$': '<rootDir>/components/$1',
  '^antd/lib/(.*)$': '<rootDir>/components/$1',
  '^antd/locale/(.*)$': '<rootDir>/components/locale/$1',
},
```

## ğŸ”„ CI/CD é…ç½®æ–‡ä»¶

### .github/workflows/test.yml - GitHub Actions æµ‹è¯•é…ç½®

#### é…ç½®æ¦‚è§ˆ

```yaml
name: âœ… test

on:
  push:
    branches: [master, feature]
  pull_request:
    branches: [master, feature]

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **å¤šç¯å¢ƒæµ‹è¯•**: React 16/17/18 ç‰ˆæœ¬æµ‹è¯•
2. **å¹¶è¡Œæ‰§è¡Œ**: åˆ†ç‰‡æµ‹è¯•æé«˜æ•ˆç‡
3. **è¦†ç›–ç‡æ”¶é›†**: è‡ªåŠ¨æ”¶é›†å’Œä¸Šä¼ è¦†ç›–ç‡
4. **æ„å»ºéªŒè¯**: éªŒè¯æ„å»ºäº§ç‰©
5. **å¹¶å‘æ§åˆ¶**: é¿å…é‡å¤æ‰§è¡Œ

#### æµ‹è¯•çŸ©é˜µé…ç½®

```yaml
test-react-legacy:
  name: test-react-legacy
  strategy:
    matrix:
      react: ['16', '17']
      shard: [1/2, 2/2]
  env:
    REACT: ${{ matrix.react }}
```

## ğŸ“ å…¶ä»–é‡è¦é…ç½®

### 1. package.json - é¡¹ç›®é…ç½®

#### å…³é”®å­—æ®µ

```json
{
  "name": "antd",
  "version": "5.27.1",
  "main": "lib/index.js",
  "module": "es/index.js",
  "unpkg": "dist/antd.min.js",
  "typings": "es/index.d.ts",
  "sideEffects": ["*.css"],
  "files": ["BUG_VERSIONS.json", "dist", "es", "lib", "locale"]
}
```

#### é‡è¦è„šæœ¬

```json
{
  "scripts": {
    "build": "npm run compile && cross-env NODE_OPTIONS='--max-old-space-size=4096' npm run dist",
    "compile": "npm run clean && antd-tools run compile",
    "dist": "antd-tools run dist",
    "test": "jest --config .jest.js --no-cache",
    "lint": "npm run version && npm run tsc && npm run lint:script && npm run lint:biome && npm run lint:md && npm run lint:style && npm run lint:changelog",
    "start": "tsx ./scripts/set-node-options.ts cross-env PORT=8001 dumi dev"
  }
}
```

### 2. tsconfig.json - TypeScript é…ç½®

#### æ ¸å¿ƒé…ç½®

```json
{
  "compilerOptions": {
    "target": "es6",
    "jsx": "react",
    "jsxFactory": "React.createElement",
    "jsxFragmentFactory": "React.Fragment",
    "lib": ["dom", "es2017"],
    "experimentalDecorators": true,
    "baseUrl": "./",
    "module": "esnext",
    "moduleResolution": "Bundler",
    "strict": true,
    "strictNullChecks": true,
    "noImplicitAny": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "stripInternal": true,
    "esModuleInterop": true,
    "skipLibCheck": true
  }
}
```

#### è·¯å¾„æ˜ å°„

```json
{
  "paths": {
    "@@/*": [".dumi/tmp/*"],
    "antd": ["components/index.ts"],
    "antd/es/*": ["components/*"],
    "antd/lib/*": ["components/*"],
    "antd/locale/*": ["components/locale/*"]
  }
}
```

## ğŸ¯ é…ç½®æœ€ä½³å®è·µ

### 1. æ„å»ºä¼˜åŒ–

- **å¤šå…¥å£é…ç½®**: æ”¯æŒä¸åŒæ ¼å¼çš„è¾“å‡º
- **å¤–éƒ¨ä¾èµ–**: å‡å°‘æ‰“åŒ…ä½“ç§¯
- **ä»£ç åˆ†å‰²**: æŒ‰éœ€åŠ è½½
- **ç¼“å­˜ä¼˜åŒ–**: æé«˜æ„å»ºé€Ÿåº¦

### 2. ä»£ç è´¨é‡

- **ç»Ÿä¸€è§„èŒƒ**: ESLint + Biome åŒé‡ä¿éšœ
- **ç±»å‹å®‰å…¨**: ä¸¥æ ¼çš„ TypeScript é…ç½®
- **è‡ªåŠ¨ä¿®å¤**: æ”¯æŒè‡ªåŠ¨æ ¼å¼åŒ–
- **è§„åˆ™å®šåˆ¶**: æ ¹æ®é¡¹ç›®éœ€æ±‚è°ƒæ•´

### 3. æµ‹è¯•ç­–ç•¥

- **å¤šç¯å¢ƒæµ‹è¯•**: ç¡®ä¿å…¼å®¹æ€§
- **å¹¶è¡Œæ‰§è¡Œ**: æé«˜æµ‹è¯•æ•ˆç‡
- **è¦†ç›–ç‡ç›‘æ§**: ä¿è¯ä»£ç è´¨é‡
- **æŒç»­é›†æˆ**: è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

### 4. æ–‡æ¡£ç®¡ç†

- **å¤šè¯­è¨€æ”¯æŒ**: ä¸­è‹±æ–‡æ–‡æ¡£
- **è‡ªåŠ¨ç”Ÿæˆ**: åŸºäºæºç ç”Ÿæˆæ–‡æ¡£
- **ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒå¤šç‰ˆæœ¬æ–‡æ¡£
- **SEO ä¼˜åŒ–**: æœç´¢å¼•æ“å‹å¥½

---

**æ€»ç»“**: Ant Design çš„é…ç½®æ–‡ä»¶ä½“ç³»éå¸¸å®Œå–„ï¼Œæ¶µç›–äº†æ„å»ºã€æµ‹è¯•ã€ä»£ç è´¨é‡ã€æ–‡æ¡£ç”Ÿæˆç­‰å„ä¸ªæ–¹é¢ï¼Œä½“ç°äº†ä¼ä¸šçº§é¡¹ç›®çš„å·¥ç¨‹åŒ–æ°´å¹³ã€‚é€šè¿‡å­¦ä¹ å’Œç†è§£è¿™äº›é…ç½®ï¼Œå¯ä»¥æŒæ¡ç°ä»£å‰ç«¯é¡¹ç›®çš„å·¥ç¨‹åŒ–æœ€ä½³å®è·µã€‚
