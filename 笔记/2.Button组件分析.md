# Button ç»„ä»¶æºç åˆ†æ

## ğŸ“‹ ç»„ä»¶æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯

- **æ–‡ä»¶è·¯å¾„**: `components/button/button.tsx`
- **ä»£ç è¡Œæ•°**: 422 è¡Œ
- **ç»„ä»¶ç±»å‹**: å‡½æ•°å¼ç»„ä»¶ + forwardRef
- **å¤æ‚åº¦**: ä¸­ç­‰ (åŒ…å«å¤šç§çŠ¶æ€å’Œå˜ä½“)

### åŠŸèƒ½ç‰¹æ€§

- æ”¯æŒå¤šç§ç±»å‹ (primary, default, dashed, link, text)
- æ”¯æŒå¤šç§å°ºå¯¸ (large, middle, small)
- æ”¯æŒå¤šç§å½¢çŠ¶ (default, circle, round)
- æ”¯æŒåŠ è½½çŠ¶æ€å’Œå»¶è¿ŸåŠ è½½
- æ”¯æŒå›¾æ ‡å’Œå›¾æ ‡ä½ç½®
- æ”¯æŒå±é™©çŠ¶æ€
- æ”¯æŒå¹½çµæ¨¡å¼
- æ”¯æŒå—çº§æ˜¾ç¤º
- æ”¯æŒè‡ªåŠ¨æ’å…¥ç©ºæ ¼ (ä¸­æ–‡)
- æ”¯æŒæ³¢çº¹æ•ˆæœ

## ğŸ—ï¸ ç»„ä»¶ç»“æ„åˆ†æ

### 1. ç±»å‹å®šä¹‰

```typescript
// åŸºç¡€æŒ‰é’®å±æ€§
export interface BaseButtonProps {
  type?: ButtonType; // æŒ‰é’®ç±»å‹
  color?: ButtonColorType; // æŒ‰é’®é¢œè‰²
  variant?: ButtonVariantType; // æŒ‰é’®å˜ä½“
  icon?: React.ReactNode; // å›¾æ ‡
  iconPosition?: 'start' | 'end'; // å›¾æ ‡ä½ç½®
  shape?: ButtonShape; // æŒ‰é’®å½¢çŠ¶
  size?: SizeType; // æŒ‰é’®å°ºå¯¸
  disabled?: boolean; // ç¦ç”¨çŠ¶æ€
  loading?: boolean | { delay?: number; icon?: React.ReactNode }; // åŠ è½½çŠ¶æ€
  prefixCls?: string; // æ ·å¼å‰ç¼€
  className?: string; // è‡ªå®šä¹‰ç±»å
  rootClassName?: string; // æ ¹å…ƒç´ ç±»å
  ghost?: boolean; // å¹½çµæ¨¡å¼
  danger?: boolean; // å±é™©çŠ¶æ€
  block?: boolean; // å—çº§æ˜¾ç¤º
  children?: React.ReactNode; // å­å…ƒç´ 
  [key: `data-${string}`]: string; // æ•°æ®å±æ€§
  classNames?: { icon: string }; // ç±»åé…ç½®
  styles?: { icon: React.CSSProperties }; // æ ·å¼é…ç½®
}

// å®Œæ•´æŒ‰é’®å±æ€§
export interface ButtonProps extends BaseButtonProps, MergedHTMLAttributes {
  href?: string; // é“¾æ¥åœ°å€
  htmlType?: ButtonHTMLType; // HTML ç±»å‹
  autoInsertSpace?: boolean; // è‡ªåŠ¨æ’å…¥ç©ºæ ¼
}
```

### 2. æ ¸å¿ƒé€»è¾‘åˆ†æ

#### 2.1 å±æ€§è§£æ„å’Œé»˜è®¤å€¼

```typescript
const {
  loading = false, // åŠ è½½çŠ¶æ€ï¼Œé»˜è®¤ false
  prefixCls: customizePrefixCls, // è‡ªå®šä¹‰æ ·å¼å‰ç¼€
  color, // é¢œè‰²
  variant, // å˜ä½“
  type, // ç±»å‹
  danger = false, // å±é™©çŠ¶æ€ï¼Œé»˜è®¤ false
  shape: customizeShape, // è‡ªå®šä¹‰å½¢çŠ¶
  size: customizeSize, // è‡ªå®šä¹‰å°ºå¯¸
  styles, // æ ·å¼é…ç½®
  disabled: customDisabled, // è‡ªå®šä¹‰ç¦ç”¨çŠ¶æ€
  className, // ç±»å
  rootClassName, // æ ¹ç±»å
  children, // å­å…ƒç´ 
  icon, // å›¾æ ‡
  iconPosition = 'start', // å›¾æ ‡ä½ç½®ï¼Œé»˜è®¤ start
  ghost = false, // å¹½çµæ¨¡å¼ï¼Œé»˜è®¤ false
  block = false, // å—çº§æ˜¾ç¤ºï¼Œé»˜è®¤ false
  htmlType = 'button', // HTML ç±»å‹ï¼Œé»˜è®¤ button
  classNames: customClassNames, // è‡ªå®šä¹‰ç±»å
  style: customStyle = {}, // è‡ªå®šä¹‰æ ·å¼
  autoInsertSpace, // è‡ªåŠ¨æ’å…¥ç©ºæ ¼
  autoFocus, // è‡ªåŠ¨èšç„¦
  ...rest // å…¶ä»–å±æ€§
} = props;
```

#### 2.2 ç±»å‹å’Œå˜ä½“æ˜ å°„

```typescript
const ButtonTypeMap: Partial<Record<ButtonType, ColorVariantPairType>> = {
  default: ['default', 'outlined'], // é»˜è®¤ç±»å‹
  primary: ['primary', 'solid'], // ä¸»è¦ç±»å‹
  dashed: ['default', 'dashed'], // è™šçº¿ç±»å‹
  link: ['link' as any, 'link'], // é“¾æ¥ç±»å‹
  text: ['default', 'text'], // æ–‡æœ¬ç±»å‹
};
```

#### 2.3 é¢œè‰²å’Œå˜ä½“è®¡ç®—

```typescript
const [mergedColor, mergedVariant] = useMemo<ColorVariantPairType>(() => {
  // æœ¬åœ°é…ç½®ä¼˜å…ˆ
  if (color && variant) {
    return [color, variant];
  }

  // ç³–è¯­æ³• (type æˆ– danger)
  if (type || danger) {
    const colorVariantPair = ButtonTypeMap[mergedType] || [];
    if (danger) {
      return ['danger', colorVariantPair[1]];
    }
    return colorVariantPair;
  }

  // Context å›é€€
  if (button?.color && button?.variant) {
    return [button.color, button.variant];
  }

  return ['default', 'outlined'];
}, [type, color, variant, danger, button?.variant, button?.color]);
```

#### 2.4 åŠ è½½çŠ¶æ€å¤„ç†

```typescript
// åŠ è½½é…ç½®å‡½æ•°
function getLoadingConfig(loading: BaseButtonProps['loading']): LoadingConfigType {
  if (typeof loading === 'object' && loading) {
    let delay = loading?.delay;
    delay = !Number.isNaN(delay) && typeof delay === 'number' ? delay : 0;
    return {
      loading: delay <= 0,
      delay,
    };
  }

  return {
    loading: !!loading,
    delay: 0,
  };
}

// åŠ è½½çŠ¶æ€ç®¡ç†
const loadingOrDelay = useMemo<LoadingConfigType>(() => getLoadingConfig(loading), [loading]);
const [innerLoading, setLoading] = useState<boolean>(loadingOrDelay.loading);

// å»¶è¿ŸåŠ è½½å¤„ç†
useLayoutEffect(() => {
  let delayTimer: ReturnType<typeof setTimeout> | null = null;
  if (loadingOrDelay.delay > 0) {
    delayTimer = setTimeout(() => {
      delayTimer = null;
      setLoading(true);
    }, loadingOrDelay.delay);
  } else {
    setLoading(loadingOrDelay.loading);
  }

  function cleanupTimer() {
    if (delayTimer) {
      clearTimeout(delayTimer);
      delayTimer = null;
    }
  }

  return cleanupTimer;
}, [loadingOrDelay.delay, loadingOrDelay.loading]);
```

#### 2.5 ä¸­æ–‡åŒå­—ç¬¦å¤„ç†

```typescript
// åŒå­—ç¬¦æ£€æµ‹
const [hasTwoCNChar, setHasTwoCNChar] = useState<boolean>(false);

// åŒå­—ç¬¦å¤„ç†
useEffect(() => {
  if (!buttonRef.current || !mergedInsertSpace) {
    return;
  }
  const buttonText = buttonRef.current.textContent || '';
  if (needInserted && isTwoCNChar(buttonText)) {
    if (!hasTwoCNChar) {
      setHasTwoCNChar(true);
    }
  } else if (hasTwoCNChar) {
    setHasTwoCNChar(false);
  }
});
```

#### 2.6 ç‚¹å‡»äº‹ä»¶å¤„ç†

```typescript
const handleClick = React.useCallback(
  (e: React.MouseEvent<HTMLButtonElement | HTMLAnchorElement, MouseEvent>) => {
    // åŠ è½½æˆ–ç¦ç”¨çŠ¶æ€ä¸‹é˜»æ­¢ç‚¹å‡»
    if (innerLoading || mergedDisabled) {
      e.preventDefault();
      return;
    }

    // è°ƒç”¨ç”¨æˆ·ä¼ å…¥çš„ onClick
    props.onClick?.(
      'href' in props
        ? (e as React.MouseEvent<HTMLAnchorElement, MouseEvent>)
        : (e as React.MouseEvent<HTMLButtonElement, MouseEvent>),
    );
  },
  [props.onClick, innerLoading, mergedDisabled],
);
```

### 3. æ ·å¼ç³»ç»Ÿé›†æˆ

#### 3.1 æ ·å¼å‰ç¼€å’Œå“ˆå¸Œ

```typescript
const prefixCls = getPrefixCls('btn', customizePrefixCls);
const [wrapCSSVar, hashId, cssVarCls] = useStyle(prefixCls);
```

#### 3.2 ç±»åè®¡ç®—

```typescript
const classes = classNames(
  prefixCls,
  hashId,
  cssVarCls,
  {
    [`${prefixCls}-${shape}`]: shape !== 'default' && shape,
    [`${prefixCls}-${mergedType}`]: mergedType,
    [`${prefixCls}-dangerous`]: danger,
    [`${prefixCls}-color-${mergedColorText}`]: mergedColorText,
    [`${prefixCls}-variant-${mergedVariant}`]: mergedVariant,
    [`${prefixCls}-${sizeCls}`]: sizeCls,
    [`${prefixCls}-icon-only`]: !children && children !== 0 && !!iconType,
    [`${prefixCls}-background-ghost`]: ghost && !isUnBorderedButtonVariant(mergedVariant),
    [`${prefixCls}-loading`]: innerLoading,
    [`${prefixCls}-two-chinese-chars`]: hasTwoCNChar && mergedInsertSpace && !innerLoading,
    [`${prefixCls}-block`]: block,
    [`${prefixCls}-rtl`]: direction === 'rtl',
    [`${prefixCls}-icon-end`]: iconPosition === 'end',
  },
  compactItemClassnames,
  className,
  rootClassName,
  contextClassName,
);
```

### 4. æ¸²æŸ“é€»è¾‘

#### 4.1 å›¾æ ‡æ¸²æŸ“

```typescript
const iconNode =
  icon && !innerLoading ? (
    <IconWrapper prefixCls={prefixCls} className={iconClasses} style={iconStyle}>
      {icon}
    </IconWrapper>
  ) : loading && typeof loading === 'object' && loading.icon ? (
    <IconWrapper prefixCls={prefixCls} className={iconClasses} style={iconStyle}>
      {loading.icon}
    </IconWrapper>
  ) : (
    <DefaultLoadingIcon
      existIcon={!!icon}
      prefixCls={prefixCls}
      loading={innerLoading}
      mount={isMountRef.current}
    />
  );
```

#### 4.2 é“¾æ¥æŒ‰é’®æ¸²æŸ“

```typescript
if (linkButtonRestProps.href !== undefined) {
  return wrapCSSVar(
    <a
      {...linkButtonRestProps}
      className={classNames(classes, {
        [`${prefixCls}-disabled`]: mergedDisabled,
      })}
      href={mergedDisabled ? undefined : linkButtonRestProps.href}
      style={fullStyle}
      onClick={handleClick}
      ref={mergedRef as React.Ref<HTMLAnchorElement>}
      tabIndex={mergedDisabled ? -1 : 0}
      aria-disabled={mergedDisabled}
    >
      {iconNode}
      {kids}
    </a>,
  );
}
```

#### 4.3 æ™®é€šæŒ‰é’®æ¸²æŸ“

```typescript
let buttonNode = (
  <button
    {...rest}
    type={htmlType}
    className={classes}
    style={fullStyle}
    onClick={handleClick}
    disabled={mergedDisabled}
    ref={mergedRef as React.Ref<HTMLButtonElement>}
  >
    {iconNode}
    {kids}
    {compactItemClassnames && <Compact prefixCls={prefixCls} />}
  </button>
);

// æ·»åŠ æ³¢çº¹æ•ˆæœ
if (!isUnBorderedButtonVariant(mergedVariant)) {
  buttonNode = (
    <Wave component="Button" disabled={innerLoading}>
      {buttonNode}
    </Wave>
  );
}
```

## ğŸ¨ è®¾è®¡æ¨¡å¼åˆ†æ

### 1. ç»„åˆæ¨¡å¼

```typescript
// Button.Group æ”¯æŒ
type CompoundedComponent = typeof InternalCompoundedButton & {
  Group: typeof Group;
  __ANT_BUTTON: boolean;
};

const Button = InternalCompoundedButton as CompoundedComponent;
Button.Group = Group;
```

### 2. Context æ¨¡å¼

```typescript
// ä½¿ç”¨å¤šä¸ª Context
const { button } = React.useContext(ConfigContext);
const disabled = useContext(DisabledContext);
const groupSize = useContext(GroupSizeContext);
```

### 3. Hooks æ¨¡å¼

```typescript
// ä½¿ç”¨å¤šä¸ªè‡ªå®šä¹‰ Hooks
const size = useSize();
const [wrapCSSVar, hashId, cssVarCls] = useStyle(prefixCls);
const { compactSize, compactItemClassnames } = useCompactItemContext(prefixCls, direction);
```

### 4. æ€§èƒ½ä¼˜åŒ–

```typescript
// ä½¿ç”¨ useMemo ä¼˜åŒ–è®¡ç®—
const [mergedColor, mergedVariant] = useMemo<ColorVariantPairType>(() => {
  // å¤æ‚è®¡ç®—é€»è¾‘
}, [type, color, variant, danger, button?.variant, button?.color]);

// ä½¿ç”¨ useCallback ä¼˜åŒ–äº‹ä»¶å¤„ç†
const handleClick = React.useCallback(
  (e) => {
    // äº‹ä»¶å¤„ç†é€»è¾‘
  },
  [props.onClick, innerLoading, mergedDisabled],
);
```

## ğŸ” å…³é”®ç‰¹æ€§å®ç°

### 1. è‡ªåŠ¨æ’å…¥ç©ºæ ¼

- æ£€æµ‹ä¸­æ–‡åŒå­—ç¬¦
- è‡ªåŠ¨åœ¨å­—ç¬¦é—´æ’å…¥ç©ºæ ¼
- æå‡ä¸­æ–‡æ’ç‰ˆæ•ˆæœ

### 2. æ³¢çº¹æ•ˆæœ

- ä½¿ç”¨ Wave ç»„ä»¶åŒ…è£…
- ä»…åœ¨éæ— è¾¹æ¡†å˜ä½“æ—¶å¯ç”¨
- åŠ è½½çŠ¶æ€ä¸‹ç¦ç”¨

### 3. å»¶è¿ŸåŠ è½½

- æ”¯æŒå»¶è¿Ÿæ˜¾ç¤ºåŠ è½½çŠ¶æ€
- ä½¿ç”¨ setTimeout å®ç°
- ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨

### 4. å¯è®¿é—®æ€§

- æ”¯æŒ aria-disabled å±æ€§
- æ”¯æŒ tabIndex æ§åˆ¶
- æ”¯æŒé”®ç›˜å¯¼èˆª

## ğŸ“š å­¦ä¹ è¦ç‚¹

### 1. ç±»å‹ç³»ç»Ÿè®¾è®¡

- ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- æ¥å£ç»§æ‰¿å’Œæ‰©å±•
- æ³›å‹çº¦æŸ

### 2. çŠ¶æ€ç®¡ç†

- ä½¿ç”¨ useState ç®¡ç†æœ¬åœ°çŠ¶æ€
- ä½¿ç”¨ useMemo ä¼˜åŒ–è®¡ç®—
- ä½¿ç”¨ useCallback ä¼˜åŒ–äº‹ä»¶

### 3. æ ·å¼ç³»ç»Ÿ

- CSS-in-JS é›†æˆ
- ä¸»é¢˜ç³»ç»Ÿæ”¯æŒ
- å“åº”å¼è®¾è®¡

### 4. æ€§èƒ½ä¼˜åŒ–

- é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- åˆç†ä½¿ç”¨ useMemo å’Œ useCallback
- åŠæ—¶æ¸…ç†å‰¯ä½œç”¨

### 5. ç”¨æˆ·ä½“éªŒ

- åŠ è½½çŠ¶æ€åé¦ˆ
- æ³¢çº¹äº¤äº’æ•ˆæœ
- ä¸­æ–‡æ’ç‰ˆä¼˜åŒ–

---

**æ€»ç»“**: Button ç»„ä»¶æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€è®¾è®¡ç²¾è‰¯çš„ React ç»„ä»¶ï¼Œä½“ç°äº†ç°ä»£å‰ç«¯å¼€å‘çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬ç±»å‹å®‰å…¨ã€æ€§èƒ½ä¼˜åŒ–ã€ç”¨æˆ·ä½“éªŒå’Œå¯ç»´æŠ¤æ€§ã€‚
